require 'tmpdir'

class TestCli < Minitest::Test
  EXPECTED_OUTPUT = %Q(first_name,last_name,dob,member_id,effective_date,expiry_date,phone_number
Jason,Bateman ,2010-12-12T00:00:00+00:00,AB 0000,,,
Brent ,Wilson,1988-01-01T00:00:00+00:00,349090,2019-09-30T00:00:00+00:00,2000-09-30T00:00:00+00:00,+13038873456
Antonio,Brown ,1966-02-02T00:00:00+00:00,890887,2019-09-30T00:00:00+00:00,2000-09-30T00:00:00+00:00,+13033339987
Jerry,Jones,1999-06-06T00:00:00+00:00,jkj3343,2016-08-04T00:00:00+00:00,2050-12-12T00:00:00+00:00,
Baker,Mayfield ,1988-01-04T00:00:00+00:00,349093,2019-09-30T00:00:00+00:00,2050-12-13T00:00:00+00:00,+13039873345
Serena, Williams,1948-04-04T00:00:00+00:00,jk 909009,2017-11-11T00:00:00+00:00,2050-12-14T00:00:00+00:00,+14445559876
Jake,Jabs,1988-01-06T00:00:00+00:00,349090,2019-09-30T00:00:00+00:00,1950-12-15T00:00:00+00:00,+14445559877
Mary,Poppins,1988-01-07T00:00:00+00:00,uu 90990,2019-09-30T00:00:00+00:00,1950-12-16T00:00:00+00:00,+14445559878
Sally,Jesse Rephael,1988-01-08T00:00:00+00:00,349097,2019-09-30T00:00:00+00:00,1950-12-17T00:00:00+00:00,+14445559879
Bruce,Springsteen,1988-01-09T00:00:00+00:00,234324,2019-09-30T00:00:00+00:00,,+14445559880
Jason,Statham,1988-02-12T00:00:00+00:00,349099,2019-09-30T00:00:00+00:00,,+16065559886
Lenny,Bruce,1988-01-11T00:00:00+00:00,349100,2019-09-30T00:00:00+00:00,,+12025559882
Martin,Short,1988-01-12T00:00:00+00:00,349101,2019-09-30T00:00:00+00:00,,+14045559883
Benny,Samson,1988-01-13T00:00:00+00:00,349102,2019-09-30T00:00:00+00:00,,+44425559884
)

  EXPECTED_REPORT = %Q(TODO implement report!)

  def test_generate_output_csv
    Dir.mktmpdir do |dir|
      `bin/cli --out-dir #{dir}`
      assert_equal EXPECTED_OUTPUT, File.read(File.join(dir, 'output.csv'))
      assert_equal EXPECTED_REPORT, File.read(File.join(dir, 'report.txt'))
    end
  end
end
